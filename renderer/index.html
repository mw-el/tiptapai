<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TipTap AI - Markdown Editor</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="../node_modules/@xterm/xterm/css/xterm.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar mit File Tree / Terminal Toggle -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <!-- View Toggle: Files / Terminal -->
        <div class="sidebar-view-toggle">
          <button id="view-files-btn" class="btn-icon view-toggle-btn active" title="Dateien anzeigen">
            <span class="material-icons">folder</span>
          </button>
          <button id="view-terminal-btn" class="btn-icon view-toggle-btn" title="Claude Terminal">
            <span class="material-icons">smart_toy</span>
          </button>
        </div>
        <div class="sidebar-header-spacer"></div>
        <!-- File-Tree Buttons (nur sichtbar im Files-Modus) -->
        <div id="files-header-buttons" class="files-header-buttons">
          <button id="folder-up-btn" class="btn-icon" title="Eine Ebene nach oben">
            <span class="material-icons">arrow_upward</span>
          </button>
          <button id="recent-items-btn" class="btn-icon" title="Zuletzt geÃ¶ffnet">
            <span class="material-icons">history</span>
          </button>
          <button id="change-folder-btn" class="btn-icon" title="Ordner wechseln">
            <span class="material-icons">folder_open</span>
          </button>
          <button id="new-file-btn" class="btn-icon" title="Neue Datei erstellen">
            <span class="material-icons">note_add</span>
          </button>
        </div>
        <!-- Terminal Buttons (nur sichtbar im Terminal-Modus) -->
        <div id="terminal-header-buttons" class="terminal-header-buttons hidden">
          <button id="terminal-refresh-btn" class="btn-icon" title="Kontext aktualisieren">
            <span class="material-icons">refresh</span>
          </button>
          <button id="terminal-help-btn" class="btn-icon" title="Claude Hilfe">
            <span class="material-icons">help_outline</span>
          </button>
        </div>
      </div>
      <!-- Files View (sichtbar im Files-Modus) -->
      <div id="files-view" class="files-view">
        <div id="recent-items-dropdown" class="recent-dropdown hidden">
          <!-- Wird dynamisch gefÃ¼llt -->
        </div>
        <div id="current-folder-display" class="current-folder-display">
          <span class="material-icons">folder_open</span>
          <span id="current-folder-name">Kein Ordner ausgewÃ¤hlt</span>
        </div>
        <div id="file-tree" class="file-tree">
          <!-- Wird dynamisch gefÃ¼llt -->
        </div>
        <!-- Table of Contents (Inhaltsverzeichnis) -->
        <div id="toc-container" class="toc-container hidden">
          <div id="toc-header" class="toc-header">
            <span class="material-icons">toc</span>
            <span class="toc-title">Inhalt</span>
            <span class="material-icons toc-toggle">expand_less</span>
          </div>
          <div id="toc-content" class="toc-content">
            <!-- Wird dynamisch gefÃ¼llt -->
          </div>
        </div>
      </div>
      <!-- Terminal Panel (versteckt bis aktiviert) -->
      <div id="terminal-panel" class="terminal-panel hidden">
        <div id="terminal-container"></div>
      </div>
    </aside>

    <!-- Editor Area -->
    <main class="editor-area">
      <!-- Editor Toolbar -->
      <div class="editor-toolbar">
        <button id="toggle-sidebar-btn" class="toolbar-btn" title="Dateibaum anzeigen/verbergen">
          <span class="material-icons">menu</span>
        </button>
        <button id="heading-btn" class="toolbar-btn" title="Ãœberschrift">
          <span class="material-icons">tag</span>
        </button>
        <div id="heading-dropdown" class="toolbar-dropdown hidden">
          <button data-level="1">H1</button>
          <button data-level="2">H2</button>
          <button data-level="3">H3</button>
          <button data-level="4">H4</button>
          <button data-level="5">H5</button>
          <button data-level="6">H6</button>
          <button data-level="0">Normal</button>
        </div>
        <button id="code-btn" class="toolbar-btn" title="Code-Format">
          <span class="material-icons">code</span>
        </button>
        <button id="shortcuts-btn" class="toolbar-btn" title="Tastenkombinationen">
          <span class="material-icons">help_outline</span>
        </button>
      </div>
      <!-- TipTap Editor Container -->
      <div id="editor"></div>
    </main>

    <!-- Control Panel (rechts) -->
    <aside class="control-panel">
      <div class="control-buttons">
        <select id="language-selector" class="control-btn" title="Sprache wÃ¤hlen">
          <option value="de-DE">ðŸ‡©ðŸ‡ª DE</option>
          <option value="de-CH">ðŸ‡¨ðŸ‡­ CH</option>
          <option value="en-US">ðŸ‡ºðŸ‡¸ EN</option>
        </select>
        <!-- LanguageTool buttons - split toggle and refresh -->
        <div class="languagetool-controls">
          <button id="languagetool-toggle" class="control-btn active" title="LanguageTool ein/aus">
            <span class="material-icons">spellcheck</span>
          </button>
          <button id="languagetool-refresh" class="control-btn" title="Sichtbaren Bereich neu prÃ¼fen">
            <span class="material-icons">refresh</span>
          </button>
        </div>
        <button id="metadata-btn" class="control-btn" title="Metadata anzeigen">
          <span class="material-icons">info</span>
        </button>
        <button id="raw-btn" class="control-btn" title="Raw Markdown anzeigen">
          <span class="material-icons">code</span>
        </button>
        <button id="save-btn" class="control-btn" title="Speichern">
          <span class="material-icons">save</span>
        </button>
        <button id="save-as-btn" class="control-btn" title="Speichern unter...">
          <span class="material-icons">save_as</span>
        </button>
        <button id="rename-btn" class="control-btn" title="Datei umbenennen">
          <span class="material-icons">drive_file_rename_outline</span>
        </button>
        <button id="delete-btn" class="control-btn" title="Datei lÃ¶schen">
          <span class="material-icons">delete</span>
        </button>
        <button id="find-replace-btn" class="control-btn" title="Suchen & Ersetzen">
          <span class="material-icons">find_replace</span>
        </button>
        <button id="export-btn" class="control-btn" title="Exportieren (PDF, DOCX, ...)">
          <span class="material-icons">file_download</span>
        </button>
      </div>
      <!-- Error List: Neu entdeckte Fehler nach Auto-Check -->
      <div id="error-list" class="error-list"></div>
      <!-- LanguageTool Server Status -->
      <div id="languagetool-server-status" class="server-status">
        <span class="status-icon material-icons">hourglass_empty</span>
        <span class="status-text">LanguageTool: PrÃ¼fe...</span>
      </div>
      <!-- Status: Ganz unten, ohne Kasten -->
      <div id="save-status" class="save-status"></div>
    </aside>
  </div>

  <!-- Modal fÃ¼r Metadata -->
  <div id="metadata-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Frontmatter Metadata</h2>
        <button class="modal-close" onclick="closeModal('metadata-modal')">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="metadata-content" class="metadata-display"></div>
      </div>
    </div>
  </div>

  <!-- Modal fÃ¼r Raw Markdown (editierbar) -->
  <div id="raw-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Raw Markdown Editor</h2>
        <button class="modal-close" onclick="closeRawModal()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <textarea id="raw-content" spellcheck="false"></textarea>
        <div class="modal-actions">
          <button id="toggle-frontmatter-btn" class="btn-secondary" onclick="toggleRawFrontmatter()">
            <span class="material-icons">list_alt</span>
            <span id="toggle-frontmatter-text">Frontmatter</span>
          </button>
          <button class="btn-primary" onclick="saveRawMarkdown()">
            <span class="material-icons">save</span>
            Save
          </button>
          <button class="btn-secondary" onclick="closeRawModal()">
            <span class="material-icons">close</span>
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal fÃ¼r Konfigurationsdateien -->
  <div id="config-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="config-modal-title">Konfigurationsdatei</h2>
        <button class="modal-close" onclick="closeConfigModal()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <textarea id="config-modal-textarea" spellcheck="false"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeConfigModal()">Abbrechen</button>
        <button class="btn-primary" onclick="saveConfigModal()">Speichern</button>
      </div>
    </div>
  </div>

  <!-- Modal fÃ¼r LanguageTool KorrekturvorschlÃ¤ge -->
  <div id="languagetool-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>LanguageTool</h2>
        <button class="modal-close" onclick="closeModal('languagetool-modal')">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="languagetool-content"></div>
      </div>
    </div>
  </div>

  <!-- Modal fÃ¼r Find & Replace -->
  <div id="find-replace-modal" class="modal draggable-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Suchen & Ersetzen</h2>
        <button class="modal-close" onclick="closeModal('find-replace-modal')">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="find-replace-form">
          <div class="form-group">
            <label for="find-input">Suchen:</label>
            <input type="text" id="find-input" placeholder="Text zum Suchen...">
          </div>
          <div class="form-group">
            <label for="replace-input">Ersetzen durch:</label>
            <input type="text" id="replace-input" placeholder="Ersatztext...">
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="replace-eszett">
              ÃŸ durch ss ersetzen
            </label>
          </div>
          <div class="form-actions">
            <button id="find-next-btn" class="btn-primary">Weitersuchen</button>
            <button id="replace-btn" class="btn-primary">Ersetzen</button>
            <button id="replace-all-btn" class="btn-primary">Alle ersetzen</button>
          </div>
          <div id="find-replace-status" class="find-replace-status"></div>
          <div class="find-replace-divider"></div>
          <div class="find-replace-presets">
            <div class="preset-row">
              <div>
                <div class="preset-title">AnfÃ¼hrungszeichen typografisch korrigieren</div>
                <div class="preset-desc">Formatiert alle AnfÃ¼hrungszeichen passend zur Dokumentensprache.</div>
              </div>
              <button class="preset-action" data-preset="quotes" title="Anwenden">
                <span class="material-icons">auto_fix_high</span>
              </button>
            </div>
            <div class="preset-row">
              <div>
                <div class="preset-title">Gedankenstriche typografisch korrigieren</div>
                <div class="preset-desc">Vereinheitlicht Doppelbindestriche, em dash und Bereiche (3-5 â†’ 3â€“5).</div>
              </div>
              <button class="preset-action" data-preset="dashes" title="Anwenden">
                <span class="material-icons">auto_fix_high</span>
              </button>
            </div>
            <div class="preset-row">
              <div>
                <div class="preset-title">Ellipsen korrigieren</div>
                <div class="preset-desc">Ersetzt drei Punkte (... oder . . .) durch â€¦</div>
              </div>
              <button class="preset-action" data-preset="ellipses" title="Anwenden">
                <span class="material-icons">auto_fix_high</span>
              </button>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <!-- Modal fÃ¼r Tastenkombinationen -->
  <div id="shortcuts-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Hilfe &amp; Tastenkombinationen</h2>
        <button class="modal-close" onclick="closeModal('shortcuts-modal')">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="accordion">
          <div class="accordion-item open">
            <button class="accordion-header">
              <span>Tastenkombinationen</span>
              <span class="accordion-icon">â–¾</span>
            </button>
            <div class="accordion-content">
              <div class="shortcuts-list">
                <h3>Ãœberschriften</h3>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Alt + 1-6</span>
                  <span class="shortcut-desc">Ãœberschrift Ebene 1-6</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Alt + 0</span>
                  <span class="shortcut-desc">Normaler Text</span>
                </div>

                <h3>Textformatierung</h3>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + B</span>
                  <span class="shortcut-desc">Fett</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + I</span>
                  <span class="shortcut-desc">Kursiv</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Shift + C</span>
                  <span class="shortcut-desc">Code (Inline)</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Shift + X</span>
                  <span class="shortcut-desc">Durchgestrichen</span>
                </div>

                <h3>Listen</h3>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Shift + 8</span>
                  <span class="shortcut-desc">AufzÃ¤hlungsliste</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Shift + 9</span>
                  <span class="shortcut-desc">Nummerierte Liste</span>
                </div>

                <h3>Sonstiges</h3>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + F</span>
                  <span class="shortcut-desc">Suchen &amp; Ersetzen</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + S</span>
                  <span class="shortcut-desc">Speichern</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Z</span>
                  <span class="shortcut-desc">RÃ¼ckgÃ¤ngig</span>
                </div>
                <div class="shortcut-item">
                  <span class="shortcut-keys">Ctrl + Shift + Z</span>
                  <span class="shortcut-desc">Wiederherstellen</span>
                </div>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <button class="accordion-header">
              <span>Suchen &amp; Ersetzen modifizieren</span>
              <span class="accordion-icon">â–¾</span>
            </button>
            <div class="accordion-content">
              <p>
                Die typografischen Suchen-&amp;-Ersetzen-Regeln werden in
                <code>renderer/ui/find-replace-settings.js</code> definiert.
                Dort findest du dokumentierte Beispiele, wie neue Muster hinzugefÃ¼gt werden.
              </p>
              <p>
                Klicke auf den folgenden Button, um die Konfigurationsdatei im Standard-Editor deines Systems zu Ã¶ffnen.
              </p>
              <button class="btn-primary" onclick="openFindReplaceSettings()">Konfigurationsdatei Ã¶ffnen</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal fÃ¼r Text-Input (ersetzt prompt()) -->
  <div id="input-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="input-modal-title">Eingabe</h2>
        <button class="modal-close" onclick="closeModal('input-modal')">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <input type="text" id="input-modal-field" style="width: 100%; padding: 8px; font-size: 14px;">
      </div>
      <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; padding: 10px;">
        <button id="input-modal-cancel" class="control-btn">Abbrechen</button>
        <button id="input-modal-ok" class="control-btn" style="background: #4CAF50; color: white;">OK</button>
      </div>
    </div>
  </div>

  <!-- Export Dialog - Pandoc Integration -->
  <div id="export-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Dokument exportieren</h2>
        <button class="modal-close" onclick="closeModal('export-modal')">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="export-form-group">
          <label for="export-format">Format</label>
          <select id="export-format">
            <option value="pdf">PDF (Pandoc)</option>
            <option value="pdf_handout">PDF Seminar-Handout</option>
            <option value="docx">Word (DOCX)</option>
            <option value="html">HTML (standalone)</option>
            <option value="latex">LaTeX</option>
            <option value="epub">EPUB (eBook)</option>
            <option value="odt">OpenDocument (ODT)</option>
            <option value="rtf">Rich Text Format (RTF)</option>
          </select>
        </div>

        <!-- Template Selector (nur fÃ¼r PDF) -->
        <div id="export-template-container" class="export-form-group" style="display: none;">
          <label for="export-template">Template</label>
          <select id="export-template">
            <option value="default">Standard</option>
            <option value="eisvogel">Eisvogel (Professional)</option>
            <option value="minimal">Minimal</option>
            <option value="academic">Academic</option>
          </select>
        </div>

        <!-- Template Info/Warning Box -->
        <div id="export-template-info" class="export-info" style="display: none;"></div>

        <!-- Asset Fields (for Electron PDF templates) -->
        <div id="export-assets-container" style="display: none;">
          <!-- Dynamic asset fields will be injected here -->
        </div>

        <!-- Options -->
        <div class="export-checkbox">
          <input type="checkbox" id="export-strip-frontmatter">
          <label for="export-strip-frontmatter">Frontmatter entfernen</label>
        </div>
      </div>

      <div class="export-modal-actions">
        <button id="export-modal-cancel">Abbrechen</button>
        <button id="export-modal-export">Exportieren</button>
      </div>
    </div>
  </div>

  <!-- Modal fÃ¼r Claude Code Hilfe -->
  <div id="claude-help-modal" class="modal">
    <div class="modal-content claude-help-content">
      <div class="modal-header">
        <h2><span class="material-icons">smart_toy</span> Claude Code Integration</h2>
        <button class="modal-close" onclick="document.getElementById('claude-help-modal').classList.remove('active')">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="claude-help-section">
          <h3>Was ist das?</h3>
          <p>Ã–ffnet ein Terminal mit Claude Code, das deinen aktuellen Text kennt.
             Claude kann dir beim Ãœberarbeiten von AbsÃ¤tzen helfen.</p>
        </div>

        <div class="claude-help-section">
          <h3>So funktioniert es</h3>
          <ol>
            <li>Klicke auf <span class="material-icons inline-icon">smart_toy</span> um das Terminal zu Ã¶ffnen</li>
            <li>Claude kennt dein Dokument und die Absatz-Nummern (Â§1, Â§2, ...)</li>
            <li>Gib Claude Anweisungen, z.B.: <code>"Ãœberarbeite Â§5, mach es kÃ¼rzer"</code></li>
            <li>Claude zeigt dir den Ã¼berarbeiteten Text</li>
            <li>Sage: <code>"In Zwischenablage"</code> - Claude kopiert nur den Text</li>
            <li>FÃ¼ge mit <kbd>Ctrl+V</kbd> im Editor ein</li>
          </ol>
        </div>

        <div class="claude-help-section">
          <h3>Beispiel-Prompts</h3>
          <ul class="example-prompts">
            <li><code>Zeige Â§5</code> - Zeigt den Absatz</li>
            <li><code>Formuliere Â§3 um, professioneller</code></li>
            <li><code>KÃ¼rze Â§12 auf die HÃ¤lfte</code></li>
            <li><code>Korrigiere Grammatik in Â§7</code></li>
            <li><code>FÃ¼ge nach Â§10 einen Ãœbergang ein</code></li>
            <li><code>Ergebnis in Zwischenablage</code> - Kopiert den Text</li>
          </ul>
        </div>

        <div class="claude-help-section">
          <h3>Wichtig</h3>
          <p>Die Absatz-Nummern findest du in der Datei <code>document-numbered.txt</code>
             im Kontext-Ordner. Claude liest diese automatisch.</p>
        </div>
      </div>
    </div>
  </div>

  <script src="app.bundle.js"></script>
</body>
</html>
